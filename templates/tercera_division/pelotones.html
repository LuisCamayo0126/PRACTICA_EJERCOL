{% extends 'base.html' %}
{% load static %}

{% block title %}Pelotones - {{ batallon|default:'Pelotones' }}{% endblock %}
{% block body_class %}tercedivi-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/tercera_division/companias.css' %}">
<link rel="stylesheet" href="{% static 'css/tercera_division/resultados.css' %}">
<link rel="stylesheet" href="{% static 'css/tercera_division/pelotones.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-wrapper">
  <div class="tercedivi-layout">
    <aside class="resultados-sidebar">
      {% include 'tercera_division/resultados.html' %}
    </aside>
    <main class="dashboard-main">
      <div class="pelotones-wrap">
        <!-- Header: title + brigade logo, battalion icon and company name (no breadcrumb links) -->
        <div class="pelotones-header" role="banner">
          <h1 class="pelotones-main-title">BOLET√çN DE RENDIMIENTO POR PELOTONES</h1>
          <div class="pelotones-emblems">
            {# Left: brigade emblem (brigada icon or emblem_left) #}
            {% if brigada_icon %}
              <div class="emblem-left" style="background-image: url('{{ brigada_icon }}');"></div>
            {% elif emblem_left %}
              <div class="emblem-left" style="background-image: url('{{ emblem_left }}');"></div>
            {% else %}
              <div class="emblem-left" style="background-image: url('{% static "images/logo_3div.png" %}');"></div>
            {% endif %}

            <div class="emblem-center">
              {# Centro: siempre mostrar el logo de la Tercera Divisi√≥n (# logo_3div.png) #}
              <div class="batallon-icon" style="background-image: url('{% static "images/logo_3div.png" %}');"></div>
              <div class="company-name">{% if compania %}{{ compania }}{% else %}Compa√±√≠a{% endif %}</div>
            </div>

            {# Right: battalion icon preferred #}
            {% if batallon_icon %}
              <div class="emblem-right" style="background-image: url('{{ batallon_icon }}');"></div>
            {% elif emblem_right %}
              <div class="emblem-right" style="background-image: url('{{ emblem_right }}');"></div>
            {% else %}
              <div class="emblem-right" style="background-image: url('{% static "images/logo_3div.png" %}');"></div>
            {% endif %}
          </div>
        </div>

        {% include 'includes/back_button.html' with label='Volver' %}

        <div class="pelotones-grid" id="pelotones-grid" data-brigada="{{ brigada|default:'' }}" data-batallon="{{ batallon|default:'' }}" data-compania="{{ compania|default:'' }}">
          {% if pelotones %}
            {% for p in pelotones %}
              <div class="peloton-card">
                <div class="peloton-header">
                  <div class="peloton-icon">üéñÔ∏è</div>
                  <div class="peloton-title">
                    <h3 class="peloton-name">{{ p }}</h3>
                  </div>
                </div>
                <div class="peloton-actions">
                  <a class="action-button" href="#">Ver Detalles</a>
                  <a class="action-button export" href="{% url 'accounts:export_peloton_csv' %}?brigada={{ brigada|urlencode }}&batallon={{ batallon|urlencode }}&compania={{ compania|urlencode }}&peloton={{ p|urlencode }}">Exportar</a>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p style="text-align:center;color:#444;">No hay pelotones para mostrar.</p>
          {% endif %}
        </div>
      </div>
    </main>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/tercera_division/resultados.js' %}"></script>
<script src="{% static 'js/tercera_division/pelotones.js' %}"></script>
{% endblock %}